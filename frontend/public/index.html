<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic Setup, SEO, Open Graph, and Meta Tags as in your previous code -->

  <!-- Pi Network SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js" async></script> <!-- Load asynchronously -->
</head>
<body>
  <div id="root"></div>

  <!-- JavaScript and SDK Initialization -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      Pi.init({
        version: "2.0",
        sandbox: true,  // Change to false in production
        appId: "your_pi_network_sdk_key"  // Replace with your actual app ID
      });
    });
  </script>

  <!-- Payment Handling Script -->
  <script>
    const Pi = window.Pi;
    let paymentId;
    let accessToken = "user_access_token";  // Replace with a secure method for managing tokens

    function createPayment() {
      const paymentData = {
        amount: 0.01,
        memo: "Purchase from Palace of Goods",  // Updated description
        metadata: { itemId: 123456 }  // Adjust metadata to match items in Palace of Goods
      };

      const paymentCallbacks = {
        onReadyForServerApproval: (paymentDTO) => {
          paymentId = paymentDTO.identifier;
          fetch('/payment/approve', {  // Adjust endpoint paths for Palace of Goods
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId, accessToken })
          });
        },
        onReadyForServerCompletion: (paymentDTO, txid) => {
          paymentId = paymentDTO.identifier;
          fetch('/payment/complete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId, txid })
          });
        },
        onCancel: (paymentDTO) => {
          paymentId = paymentDTO.identifier;
          fetch('/payment/cancel', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId })
          });
        },
        onError: (paymentDTO) => {
          console.error('Payment error:', paymentDTO);
          paymentId = paymentDTO.identifier;
          fetch('/payment/error', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId })
          });
        },
        onIncompletePaymentFound: (paymentDTO) => {
          paymentId = paymentDTO.identifier;
          const txid = paymentDTO.transaction.txid;
          fetch('/payment/complete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentId, txid })
          });
        }
      };

      Pi.createPayment(paymentData, paymentCallbacks);
    }

    // Authentication for Pi payments
    const scopes = ['payments'];

    Pi.authenticate(scopes, (payment) => {
      const paymentId = payment.identifier;
      const txid = payment.transaction.txid;
      fetch('/payment/complete', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ paymentId, txid })
      });
    }).then((auth) => {
      console.log('Authentication successful:', auth);
    }).catch((error) => {
      console.error('Authentication error:', error);
    });
  </script>

  <!-- Additional JavaScript files -->
  <script src="/static/js/bundle.js" defer></script>
  <script src="/static/js/main.chunk.js" defer></script>
</body>
</html>
